import{f as e,k as a,l,o as n,c as o,a as t,m as s,v as c,u,F as p,n as r,t as i,q as m,e as d,p as v,d as b,s as f,x as y,y as h,z as k,b as g}from"./vendor.fd49238e.js";import{c as C}from"./deployment.efd82eeb.js";import{_ as x}from"./index.257cab03.js";const D=e=>(v("data-v-0dfbeffc"),e=e(),b(),e),U={key:0,class:"edit-box"},V={class:"deployment"},w=d(" Name "),L=d(" Namespace "),F=d(" Replicas "),N={class:"containers"},R={class:"title"},j=["onClick"],P={class:"image"},$=D((()=>t("label",null,"Image",-1))),_=["onUpdate:modelValue"],q={class:"ports"},A=D((()=>t("label",null,"Port",-1))),B=["onUpdate:modelValue"],I=["onClick"],O=["onClick"],z={class:"actions"};var M=x(e({setup(e){let d=a({name:"my-nginx-23421",namespace:"default",replicas:10,containers:[{image:"hub.example.com/nginx:alpine",ports:[{value:80}]}]});const v=l(!1),b=function(){v.value=!v.value},f=async function(){const e={replicas:d.replicas,containers:y(d.containers)};console.log(e);const a=await C.createDeploymentByName(d.namespace,d.name,e);console.log(a.data)},y=function(e){const a=[];for(const l of e){const e=[];for(const a of l.ports)e.push(a.value);a.push({image:l.image,ports:e})}return a};return(e,a)=>(n(),o(p,null,[t("button",{onClick:b},"打开/关闭创建面板"),v.value?(n(),o("div",U,[t("div",V,[t("label",null,[w,s(t("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>u(d).name=e)},null,512),[[c,u(d).name]])]),t("label",null,[L,s(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>u(d).namespace=e)},null,512),[[c,u(d).namespace]])]),t("label",null,[F,s(t("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=e=>u(d).replicas=e)},null,512),[[c,u(d).replicas]])]),t("div",N,[(n(!0),o(p,null,r(u(d).containers,((e,a)=>(n(),o("div",{class:"container",key:a},[t("div",R,[t("div",null,"Container 编号: "+i(a),1),t("div",null,[t("button",{onClick:e=>{return l=u(d).containers,n=a,void(l&&l.splice(n,1));var l,n}},"删除当前container",8,j)])]),t("div",P,[$,s(t("input",{type:"text","onUpdate:modelValue":a=>e.image=a},null,8,_),[[c,e.image]])]),t("div",q,[(n(!0),o(p,null,r(e.ports,((a,l)=>(n(),o("div",{class:"port",key:l},[A,s(t("input",{type:"text","onUpdate:modelValue":e=>a.value=e},null,8,B),[[c,a.value,void 0,{number:!0}]]),t("button",{onClick:a=>{return n=e.ports,o=l,void(n&&n.splice(o,1));var n,o}},"删除",8,I)])))),128)),t("button",{onClick:a=>{e.ports.push({value:0})}},"增加 Port",8,O)])])))),128)),t("button",{onClick:a[3]||(a[3]=e=>{u(d).containers.push({ports:[]})})},"增加 Container")])]),t("div",z,[t("button",{onClick:f},"确认创建"),t("button",{onClick:a[4]||(a[4]=e=>v.value=!1)},"取消")])])):m("",!0)],64))}}),[["__scopeId","data-v-0dfbeffc"]]);const T=t("h3",null,"deployments",-1),E=t("label",null,"namespace",-1),G=["placeholder"],H=["href"],J=[t("button",null,"更新数据",-1)],K={key:0,class:"error-container"},Q=t("h3",null,"error",-1),S={key:1,class:"table"},W=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"#"),t("th",{scope:"col"},"状态"),t("th",{scope:"col"},"名字"),t("th",{scope:"col"},"Namespace"),t("th",{scope:"col"},"期望副本数量"),t("th",{scope:"col"},"镜像列表"),t("th",{scope:"col"},"Pod 总数/可用/不可用"),t("th",{scope:"col"},"Action")])],-1),X={scope:"row"},Y=["href"],Z=t("span",null,"/",-1),ee=t("span",null,"/",-1),ae=["onClick"],le=e({setup(e){const l=f();let d=a({namespace:"",error:"",items:[]});const v=l.currentRoute.value.query.namespace;let b=a({LoopData:!1});const x=async function(){const e=await C.getAllDeployments(v);let a=e.data.sort(((e,a)=>e.name>=a.name?1:-1));d.items=a,d.error=e.error},D=function(e){return`/deployments/${e.name}?namespace=${e.namespace}`},U=y((()=>`/deployments?namespace=${d.namespace}`));return h((()=>{b.LoopData=!0,console.log("onMounted: onOFF.loop",b.LoopData),async function(){for(;b.LoopData;)x(),await new Promise((e=>setTimeout(e,2e3)))}()})),k((()=>{b.LoopData=!1,console.log("onUnmounted: onOFF.loop",b.LoopData)})),(e,a)=>(n(),o(p,null,[g(M),T,t("div",null,[E,s(t("input",{type:"text",placeholder:u(v),"onUpdate:modelValue":a[0]||(a[0]=e=>u(d).namespace=e)},null,8,G),[[c,u(d).namespace]]),t("a",{href:u(U),onClick:a[1]||(a[1]=e=>x())},J,8,H)]),u(d).error?(n(),o("div",K,[Q,t("h3",null,i(u(d).error),1)])):m("",!0),u(d).error?m("",!0):(n(),o("table",S,[W,t("tbody",null,[(n(!0),o(p,null,r(u(d).items,((e,a)=>{return n(),o("tr",{key:e.name+"-"+e.namespace},[t("th",X,i(a),1),t("td",null,i((s=e.replicas,c=e.status.availableReplicas,s===c)),1),t("td",null,[t("a",{href:D(e)},i(e.name),9,Y)]),t("td",null,i(e.namespace),1),t("td",null,i(e.replicas),1),t("td",null,i((l=e.images,l.join(","))),1),t("td",null,[t("span",null,i(e.status.replicas),1),Z,t("span",null,i(e.status.availableReplicas),1),ee,t("span",null,i(e.status.unavailableReplicas),1)]),t("td",null,[t("button",{class:"btn btn-danger",onClick:a=>async function(e){const a=await C.deleteDeploymentByName(e.namespace,e.name);0===a.code||console.log("delete pod failed: ",a.error)}(e)},"删除",8,ae)])]);var l,s,c})),128))])]))],64))}});export{le as default};
